<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Snakes</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.12.3/application.js' type='text/javascript'></script>
    <link href='./assets/0.12.3/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="shortcut icon" type="image/png" href="./assets/0.12.3/favicon_red.png" />
    <link rel="icon" type="image/png" href="./assets/0.12.3/favicon.png" />
  </head>

  <body>
    <div id="loading">
      <img src="./assets/0.12.3/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2025-08-14T16:25:33+00:00">2025-08-14T16:25:33+00:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="red">
  69.69%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         1098.98
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>3</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>508</b> relevant lines,
    <span class="green"><b>354</b> lines covered</span> and
    <span class="red"><b>154</b> lines missed. </span>
    (<span class="red">
  69.69%
</span>
)
  </div>

  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1015b89735359fa1a1ed58793f24dceea347bd67" class="src_link" title="snakes/ruby/djdefi/app/app.rb">snakes/ruby/djdefi/app/app.rb</a></td>
            <td class="red strong cell--number t-file__coverage">54.29 %</td>
            <td class="cell--number">81</td>
            <td class="cell--number">35</td>
            <td class="cell--number">19</td>
            <td class="cell--number">16</td>
            <td class="cell--number">1.26</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ac6f7d49a6ce67e8bcfe2f6709684cb988b44406" class="src_link" title="snakes/ruby/djdefi/app/move.rb">snakes/ruby/djdefi/app/move.rb</a></td>
            <td class="red strong cell--number t-file__coverage">70.51 %</td>
            <td class="cell--number">1058</td>
            <td class="cell--number">468</td>
            <td class="cell--number">330</td>
            <td class="cell--number">138</td>
            <td class="cell--number">1190.81</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a0fd061293fd095d34df636e6fce494a596225be" class="src_link" title="snakes/ruby/djdefi/app/util.rb">snakes/ruby/djdefi/app/util.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">187.80</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.12.3<br/>
        using Unit Tests
      </div>

      <div class="source_files">
      
        <div class="source_table" id="1015b89735359fa1a1ed58793f24dceea347bd67">
  <div class="header">
    <h3>snakes/ruby/djdefi/app/app.rb</h3>
    <h4>
      <span class="red">
  54.29%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>35</b> relevant lines.
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;rack&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;rack/contrib&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;sinatra&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;json&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;./util&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">require_relative &#39;./move&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            <span class="hits">1</span>
            

            

            <code class="ruby">use Rack::PostBodyContentTypeParser</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            
            

            

            <code class="ruby"># This function is called when you register your Battlesnake on play.battlesnake.com</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby"># It controls your Battlesnake appearance and author permissions.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby"># TIP: If you open your Battlesnake URL in browser you should see this data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            <span class="hits">1</span>
            

            

            <code class="ruby">get &#39;/&#39; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            <span class="hits">1</span>
            

            

            <code class="ruby">  content_type :json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            <span class="hits">1</span>
            

            

            <code class="ruby">  appearance = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            
            

            

            <code class="ruby">    apiversion: &#39;1&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">    author: &#39;djdefi&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby">    color: &#39;#ff33fb&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby">    head: &#39;gamer&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            
            

            

            <code class="ruby">    tail: &#39;virus&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            <span class="hits">1</span>
            

            

            <code class="ruby">  camelcase(appearance).to_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            
            

            

            <code class="ruby"># This function is called everytime your snake is entered into a game.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            
            

            

            <code class="ruby"># rack.request.form_hash contains information about the game that&#39;s about to be played.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            
            

            

            <code class="ruby"># TODO: Use this function to decide how your snake is going to look on the board.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &#39;/start&#39; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            
            

            

            <code class="ruby">  request = underscore(env[&#39;rack.request.form_hash&#39;])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            
            

            

            <code class="ruby">  puts &#39;[GAME START]&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            
            

            

            <code class="ruby">  &quot;OK\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            
            

            

            <code class="ruby"># This function is called on every turn of a game. It&#39;s how your snake decides where to move.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby"># Valid moves are &quot;up&quot;, &quot;down&quot;, &quot;left&quot;, or &quot;right&quot;.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            
            

            

            <code class="ruby"># TODO: Use the information in rack.request.form_hash to decide your next move.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &#39;/move&#39; do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            
            

            

            <code class="ruby">    # Puts raw request body</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="44">
            <span class="hits">6</span>
            

            

            <code class="ruby">  puts request.body.read</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="45">
            <span class="hits">6</span>
            

            

            <code class="ruby">  request = underscore(env[&#39;rack.request.form_hash&#39;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            
            

            

            <code class="ruby">  # Implement move logic in app/move.rb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="48">
            <span class="hits">6</span>
            

            

            <code class="ruby">  response = move(request)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="49">
            <span class="hits">6</span>
            

            

            <code class="ruby">  content_type :json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="50">
            <span class="hits">6</span>
            

            

            <code class="ruby">  camelcase(response).to_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby"># This function is called when a game your Battlesnake was in ends.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby"># It&#39;s purely for informational purposes, you don&#39;t have to make any decisions here.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            <span class="hits">1</span>
            

            

            <code class="ruby">post &#39;/end&#39; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            
            

            

            <code class="ruby">  puts &#39;[GAME END]&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby">  # Example response: {:game=&gt;{:id=&gt;&quot;f9ffcf38-5fa1-4b2b-b002-cea8038b4186&quot;, :ruleset=&gt;{:name=&gt;&quot;standard&quot;, :version=&gt;&quot;v1.0.22&quot;, :settings=&gt;{:food_spawn_chance=&gt;15, :minimum_food=&gt;1, :hazard_damage_per_turn=&gt;0, :royale=&gt;{:shrink_every_n_turns=&gt;0}, :squad=&gt;{:allow_body_collisions=&gt;false, :shared_elimination=&gt;false, :shared_health=&gt;false, :shared_length=&gt;false}}}, :timeout=&gt;500}, :turn=&gt;29, :board=&gt;{:height=&gt;11, :width=&gt;11, :snakes=&gt;[{:id=&gt;&quot;gs_mKHqbptvV64kvGwbqXG49QFC&quot;, :name=&gt;&quot;code-snek-dev&quot;, :latency=&gt;&quot;97&quot;, :health=&gt;100, :body=&gt;[{:x=&gt;7, :y=&gt;4}, {:x=&gt;7, :y=&gt;3}, {:x=&gt;7, :y=&gt;2}, {:x=&gt;7, :y=&gt;1}, {:x=&gt;7, :y=&gt;0}, {:x=&gt;8, :y=&gt;0}, {:x=&gt;9, :y=&gt;0}, {:x=&gt;9, :y=&gt;0}], :head=&gt;{:x=&gt;7, :y=&gt;4}, :length=&gt;8, :shout=&gt;&quot;&quot;, :squad=&gt;&quot;&quot;}], :food=&gt;[{:x=&gt;9, :y=&gt;5}, {:x=&gt;10, :y=&gt;5}, {:x=&gt;0, :y=&gt;10}], :hazards=&gt;[]}, :you=&gt;{:id=&gt;&quot;gs_mKHqbptvV64kvGwbqXG49QFC&quot;, :name=&gt;&quot;code-snek-dev&quot;, :latency=&gt;&quot;97&quot;, :health=&gt;100, :body=&gt;[{:x=&gt;7, :y=&gt;4}, {:x=&gt;7, :y=&gt;3}, {:x=&gt;7, :y=&gt;2}, {:x=&gt;7, :y=&gt;1}, {:x=&gt;7, :y=&gt;0}, {:x=&gt;8, :y=&gt;0}, {:x=&gt;9, :y=&gt;0}, {:x=&gt;9, :y=&gt;0}], :head=&gt;{:x=&gt;7, :y=&gt;4}, :length=&gt;8, :shout=&gt;&quot;&quot;, :squad=&gt;&quot;&quot;}}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            
            

            

            <code class="ruby">  # Output the last request form_hash to the terminal for debugging purposes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            
            

            

            <code class="ruby">  request = underscore(env[&#39;rack.request.form_hash&#39;])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            
            

            

            <code class="ruby">  puts request</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">  # Output the game id, ruleset name, turn number, your health, all snakes names + health (if any).</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            
            

            

            <code class="ruby">  puts &quot;Game ID: https://play.battlesnake.com/g/#{request[:game][:id]}/&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            
            

            

            <code class="ruby">  puts &quot;Ruleset: #{request[:game][:ruleset][:name]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            
            

            

            <code class="ruby">  puts &quot;Last Turn: #{request[:turn]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            
            

            

            <code class="ruby">  puts &quot;Your Health: #{request[:you][:health]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            
            

            

            <code class="ruby">  request[:board][:snakes].each do |snake|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            
            

            

            <code class="ruby">    puts &quot;Surviving Snake: #{snake[:name]} Health: #{snake[:health]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">    # If the snake is you, we won!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            
            

            

            <code class="ruby">    if snake[:id] == request[:you][:id]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            
            

            

            <code class="ruby">      puts &#39;You won!&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            
            

            

            <code class="ruby">      puts &#39;You lost!&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            
            

            

            <code class="ruby">  &quot;OK\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ac6f7d49a6ce67e8bcfe2f6709684cb988b44406">
  <div class="header">
    <h3>snakes/ruby/djdefi/app/move.rb</h3>
    <h4>
      <span class="red">
  70.51%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>468</b> relevant lines.
      <span class="green"><b>330</b> lines covered</span> and
      <span class="red"><b>138</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;set&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            <span class="hits">1</span>
            

            

            <code class="ruby">$VERBOSE = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            <span class="hits">1</span>
            

            

            <code class="ruby">$stdout.sync = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            
            

            

            <code class="ruby"># A* pathfinding to find the safest path to food</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            <span class="hits">1</span>
            

            

            <code class="ruby">def a_star_to_food(board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="10">
            <span class="hits">6</span>
            

            

            <code class="ruby">  return nil if board_state[:food].empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="12">
            <span class="hits">30</span>
            

            

            <code class="ruby">  closest_food = board_state[:food].min_by { |f| manhattan_distance(board_state[:head], f) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="13">
            <span class="hits">6</span>
            

            

            <code class="ruby">  path = a_star_pathfind(board_state[:head], closest_food, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="15">
            <span class="hits">6</span>
            

            

            <code class="ruby">  return nil if path.nil? || path.length &lt; 2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            
            

            

            <code class="ruby">  # Return the direction to the next step in the path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="18">
            <span class="hits">1</span>
            

            

            <code class="ruby">  next_step = path[1]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            <span class="hits">1</span>
            

            

            <code class="ruby">  direction_between(board_state[:head][:x], board_state[:head][:y], next_step[:x], next_step[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            
            

            

            <code class="ruby"># Manhattan distance between two points</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            <span class="hits">1</span>
            

            

            <code class="ruby">def manhattan_distance(point1, point2)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="748" data-linenumber="24">
            <span class="hits">748</span>
            

            

            <code class="ruby">  (point1[:x] - point2[:x]).abs + (point1[:y] - point2[:y]).abs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            
            

            

            <code class="ruby"># A* pathfinding algorithm</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            <span class="hits">1</span>
            

            

            <code class="ruby">def a_star_pathfind(start, goal, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="29">
            <span class="hits">6</span>
            

            

            <code class="ruby">  open_set = [start]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="30">
            <span class="hits">6</span>
            

            

            <code class="ruby">  came_from = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="31">
            <span class="hits">6</span>
            

            

            <code class="ruby">  g_score = { start =&gt; 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="32">
            <span class="hits">6</span>
            

            

            <code class="ruby">  f_score = { start =&gt; manhattan_distance(start, goal) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="34">
            <span class="hits">6</span>
            

            

            <code class="ruby">  while !open_set.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="742" data-linenumber="35">
            <span class="hits">742</span>
            

            

            <code class="ruby">    current = open_set.min_by { |node| f_score[node] || Float::INFINITY }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="141" data-linenumber="37">
            <span class="hits">141</span>
            

            

            <code class="ruby">    return reconstruct_path(came_from, current) if current == goal</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="139" data-linenumber="39">
            <span class="hits">139</span>
            

            

            <code class="ruby">    open_set.delete(current)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="139" data-linenumber="41">
            <span class="hits">139</span>
            

            

            <code class="ruby">    neighbors = get_safe_neighbors(current, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="139" data-linenumber="42">
            <span class="hits">139</span>
            

            

            <code class="ruby">    neighbors.each do |neighbor|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="405" data-linenumber="43">
            <span class="hits">405</span>
            

            

            <code class="ruby">      tentative_g_score = g_score[current] + 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="405" data-linenumber="45">
            <span class="hits">405</span>
            

            

            <code class="ruby">      if tentative_g_score &lt; (g_score[neighbor] || Float::INFINITY)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="137" data-linenumber="46">
            <span class="hits">137</span>
            

            

            <code class="ruby">        came_from[neighbor] = current</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="137" data-linenumber="47">
            <span class="hits">137</span>
            

            

            <code class="ruby">        g_score[neighbor] = tentative_g_score</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="137" data-linenumber="48">
            <span class="hits">137</span>
            

            

            <code class="ruby">        f_score[neighbor] = tentative_g_score + manhattan_distance(neighbor, goal)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="137" data-linenumber="50">
            <span class="hits">137</span>
            

            

            <code class="ruby">        open_set &lt;&lt; neighbor unless open_set.include?(neighbor)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            
            

            

            <code class="ruby">  nil # No path found</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            
            

            

            <code class="ruby"># Get safe neighbors for pathfinding</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            <span class="hits">1</span>
            

            

            <code class="ruby">def get_safe_neighbors(cell, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="139" data-linenumber="60">
            <span class="hits">139</span>
            

            

            <code class="ruby">  adjacent_cells(cell[:x], cell[:y]).select do |neighbor|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="556" data-linenumber="61">
            <span class="hits">556</span>
            

            

            <code class="ruby">    !is_wall_for_board?(neighbor[:x], neighbor[:y], board_state) &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            
            

            

            <code class="ruby">    !is_occupied_for_board?(neighbor[:x], neighbor[:y], board_state) &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            
            

            

            <code class="ruby">    !is_dangerous_for_board?(neighbor[:x], neighbor[:y], board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            
            

            

            <code class="ruby"># Check if a cell is occupied by any snake</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="68">
            <span class="hits">1</span>
            

            

            <code class="ruby">def is_occupied_for_board?(x, y, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="929" data-linenumber="69">
            <span class="hits">929</span>
            

            

            <code class="ruby">  board_state[:all_occupied_cells].any? do |cell| </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31922" data-linenumber="70">
            <span class="hits">31922</span>
            

            

            <code class="ruby">    cell.is_a?(Hash) &amp;&amp; cell[:x].to_i == x.to_i &amp;&amp; cell[:y].to_i == y.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            
            

            

            <code class="ruby"># Check if a cell is dangerous (near enemy snake heads or hazards)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            <span class="hits">1</span>
            

            

            <code class="ruby">def is_dangerous_for_board?(x, y, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            
            

            

            <code class="ruby">  # Check if it&#39;s a hazard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12775" data-linenumber="77">
            <span class="hits">12775</span>
            

            

            <code class="ruby">  return true if board_state[:hazards].any? { |h| h[:x].to_i == x.to_i &amp;&amp; h[:y].to_i == y.to_i }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            
            

            

            <code class="ruby">  # Check if it&#39;s adjacent to a longer or equal length enemy snake head</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="423" data-linenumber="80">
            <span class="hits">423</span>
            

            

            <code class="ruby">  board_state[:snakes_heads_not_my_head].each do |enemy_head|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1302" data-linenumber="81">
            <span class="hits">1302</span>
            

            

            <code class="ruby">    enemy_snake = board_state[:snakes].find { |s| s[:head] == enemy_head }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="575" data-linenumber="82">
            <span class="hits">575</span>
            

            

            <code class="ruby">    next unless enemy_snake</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="575" data-linenumber="84">
            <span class="hits">575</span>
            

            

            <code class="ruby">    if enemy_snake[:length] &gt;= board_state[:length] &amp;&amp; manhattan_distance({x: x, y: y}, enemy_head) &lt;= 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="85">
            <span class="hits">18</span>
            

            

            <code class="ruby">      return true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="405" data-linenumber="89">
            <span class="hits">405</span>
            

            

            <code class="ruby">  false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            
            

            

            <code class="ruby"># Check if a cell is a wall for pathfinding</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            <span class="hits">1</span>
            

            

            <code class="ruby">def is_wall_for_board?(x, y, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1087" data-linenumber="94">
            <span class="hits">1087</span>
            

            

            <code class="ruby">  game_mode = board_state[:game_mode]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1087" data-linenumber="95">
            <span class="hits">1087</span>
            

            

            <code class="ruby">  width = board_state[:width]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1087" data-linenumber="96">
            <span class="hits">1087</span>
            

            

            <code class="ruby">  height = board_state[:height]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1087" data-linenumber="98">
            <span class="hits">1087</span>
            

            

            <code class="ruby">  if game_mode == &#39;wrapped&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            
            

            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            
            

            

            <code class="ruby">  else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1087" data-linenumber="101">
            <span class="hits">1087</span>
            

            

            <code class="ruby">    x.negative? || y.negative? || x &gt;= width || y &gt;= height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            
            

            

            <code class="ruby"># Reconstruct path from A* algorithm</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="106">
            <span class="hits">1</span>
            

            

            <code class="ruby">def reconstruct_path(came_from, current)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="107">
            <span class="hits">2</span>
            

            

            <code class="ruby">  path = [current]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="108">
            <span class="hits">2</span>
            

            

            <code class="ruby">  while came_from[current]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="109">
            <span class="hits">2</span>
            

            

            <code class="ruby">    current = came_from[current]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="110">
            <span class="hits">2</span>
            

            

            <code class="ruby">    path.unshift(current)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="112">
            <span class="hits">2</span>
            

            

            <code class="ruby">  path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            
            

            

            <code class="ruby"># Flood fill to avoid dead ends</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            <span class="hits">1</span>
            

            

            <code class="ruby">def flood_fill_from(start_pos, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="117">
            <span class="hits">4</span>
            

            

            <code class="ruby">  visited = Set.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="118">
            <span class="hits">4</span>
            

            

            <code class="ruby">  queue = [start_pos]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="119">
            <span class="hits">4</span>
            

            

            <code class="ruby">  visited.add(start_pos)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="121">
            <span class="hits">4</span>
            

            

            <code class="ruby">  while !queue.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="319" data-linenumber="122">
            <span class="hits">319</span>
            

            

            <code class="ruby">    current = queue.shift</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="319" data-linenumber="124">
            <span class="hits">319</span>
            

            

            <code class="ruby">    adjacent_cells(current[:x], current[:y]).each do |neighbor|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1276" data-linenumber="125">
            <span class="hits">1276</span>
            

            

            <code class="ruby">      next if visited.include?(neighbor)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="523" data-linenumber="126">
            <span class="hits">523</span>
            

            

            <code class="ruby">      next if is_wall_for_board?(neighbor[:x], neighbor[:y], board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="397" data-linenumber="127">
            <span class="hits">397</span>
            

            

            <code class="ruby">      next if is_occupied_for_board?(neighbor[:x], neighbor[:y], board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="315" data-linenumber="129">
            <span class="hits">315</span>
            

            

            <code class="ruby">      visited.add(neighbor)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="315" data-linenumber="130">
            <span class="hits">315</span>
            

            

            <code class="ruby">      queue &lt;&lt; neighbor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="134">
            <span class="hits">4</span>
            

            

            <code class="ruby">  visited.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            
            

            

            <code class="ruby"># Get the move direction that leads to the largest space</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="138">
            <span class="hits">1</span>
            

            

            <code class="ruby">def get_space_control_move(board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="139">
            <span class="hits">2</span>
            

            

            <code class="ruby">  best_move = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="140">
            <span class="hits">2</span>
            

            

            <code class="ruby">  largest_space = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="142">
            <span class="hits">2</span>
            

            

            <code class="ruby">  board_state[:head_neighbors].each do |neighbor|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="143">
            <span class="hits">8</span>
            

            

            <code class="ruby">    next if is_wall_for_board?(neighbor[:x], neighbor[:y], board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="144">
            <span class="hits">8</span>
            

            

            <code class="ruby">    next if is_occupied_for_board?(neighbor[:x], neighbor[:y], board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="146">
            <span class="hits">4</span>
            

            

            <code class="ruby">    space_size = flood_fill_from(neighbor, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="148">
            <span class="hits">4</span>
            

            

            <code class="ruby">    if space_size &gt; largest_space</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="149">
            <span class="hits">2</span>
            

            

            <code class="ruby">      largest_space = space_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="150">
            <span class="hits">2</span>
            

            

            <code class="ruby">      best_move = direction_between(board_state[:head][:x], board_state[:head][:y], neighbor[:x], neighbor[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="154">
            <span class="hits">2</span>
            

            

            <code class="ruby">  { move: best_move, space_size: largest_space }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            
            

            

            <code class="ruby"># Predict where enemy snakes will move</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="158">
            <span class="hits">1</span>
            

            

            <code class="ruby">def predict_enemy_moves(board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            
            

            

            <code class="ruby">  enemy_predictions = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="161">
            
            

            

            <code class="ruby">  board_state[:snakes_heads_not_my_head].each do |enemy_head|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="162">
            
            

            

            <code class="ruby">    enemy_snake = board_state[:snakes].find { |s| s[:head] == enemy_head }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="163">
            
            

            

            <code class="ruby">    next unless enemy_snake</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            
            

            

            <code class="ruby">    # Simple prediction: enemy will move towards food or away from walls</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            
            

            

            <code class="ruby">    safe_moves = adjacent_cells(enemy_head[:x], enemy_head[:y]).select do |move|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="167">
            
            

            

            <code class="ruby">      !is_wall_for_board?(move[:x], move[:y], board_state) &amp;&amp; !is_occupied_for_board?(move[:x], move[:y], board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="170">
            
            

            

            <code class="ruby">    if !safe_moves.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            
            

            

            <code class="ruby">      # Predict they&#39;ll move towards nearest food if hungry, otherwise away from walls</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="172">
            
            

            

            <code class="ruby">      if enemy_snake[:health] &lt; 50 &amp;&amp; !board_state[:food].empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="173">
            
            

            

            <code class="ruby">        nearest_food = board_state[:food].min_by { |f| manhattan_distance(enemy_head, f) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="174">
            
            

            

            <code class="ruby">        predicted_move = safe_moves.min_by { |move| manhattan_distance(move, nearest_food) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            
            

            

            <code class="ruby">        # Move towards center of board or largest space</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="177">
            
            

            

            <code class="ruby">        predicted_move = safe_moves.max_by { |move| </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            
            

            

            <code class="ruby">          flood_fill_from(move, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            
            

            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="182">
            
            

            

            <code class="ruby">      enemy_predictions[enemy_snake[:id]] = predicted_move</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="186">
            
            

            

            <code class="ruby">  enemy_predictions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            
            

            

            <code class="ruby"># This function is called on every turn of a game. It&#39;s how your Battlesnake decides where to move.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            
            

            

            <code class="ruby"># Valid moves are &quot;up&quot;, &quot;down&quot;, &quot;left&quot;, or &quot;right&quot;.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            
            

            

            <code class="ruby"># TODO: Use the information in board to decide your next move.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="192">
            <span class="hits">1</span>
            

            

            <code class="ruby">def move(board)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            
            

            

            <code class="ruby">  # Record the start time of the turn</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="194">
            <span class="hits">6</span>
            

            

            <code class="ruby">  start_time = Time.now</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            
            

            

            <code class="ruby">  # Health find threshold variable clamped to 0-100</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="197">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @health_threshold = 99</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="198">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @health_threshold.clamp(0, 100)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            
            

            

            <code class="ruby">  #puts board</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            
            

            

            <code class="ruby">  # Example board object:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            
            

            

            <code class="ruby">  # {:game=&gt;{:id=&gt;&quot;f767ba58-945c-4f5a-b5b6-12990dc27ab1&quot;, :ruleset=&gt;{:name=&gt;&quot;standard&quot;, :version=&gt;&quot;v1.0.17&quot;}, :timeout=&gt;500}, :turn=&gt;0, :board=&gt;{:height=&gt;11, :width=&gt;11, :snakes=&gt;[{:id=&gt;&quot;gs_9PwkMwt7S3CtB9vFGjVbH39V&quot;, :name=&gt;&quot;ruby-danger-noodle&quot;, :latency=&gt;&quot;&quot;, :health=&gt;100, :body=&gt;[{:x=&gt;9, :y=&gt;9}, {:x=&gt;9, :y=&gt;9}, {:x=&gt;9, :y=&gt;9}], :head=&gt;{:x=&gt;9, :y=&gt;9}, :length=&gt;3, :shout=&gt;&quot;&quot;}, {:id=&gt;&quot;gs_qrT8RGkMKCyYCtpphtkTfQkX&quot;, :name=&gt;&quot;LoopSnake&quot;, :latency=&gt;&quot;&quot;, :health=&gt;100, :body=&gt;[{:x=&gt;9, :y=&gt;1}, {:x=&gt;9, :y=&gt;1}, {:x=&gt;9, :y=&gt;1}], :head=&gt;{:x=&gt;9, :y=&gt;1}, :length=&gt;3, :shout=&gt;&quot;&quot;}], :food=&gt;[{:x=&gt;8, :y=&gt;10}, {:x=&gt;8, :y=&gt;2}, {:x=&gt;5, :y=&gt;5}], :hazards=&gt;[]}, :you=&gt;{:id=&gt;&quot;gs_9PwkMwt7S3CtB9vFGjVbH39V&quot;, :name=&gt;&quot;ruby-danger-noodle&quot;, :latency=&gt;&quot;&quot;, :health=&gt;100, :body=&gt;[{:x=&gt;9, :y=&gt;9}, {:x=&gt;9, :y=&gt;9}, {:x=&gt;9, :y=&gt;9}], :head=&gt;{:x=&gt;9, :y=&gt;9}, :length=&gt;3, :shout=&gt;&quot;&quot;}}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            
            

            

            <code class="ruby">  # Puts board height and width</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="206">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @height = board[:board][:height].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="207">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @width = board[:board][:width].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            
            

            

            <code class="ruby">  # Puts all the snakes in an array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="210">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @snakes = board[:board][:snakes] || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            
            

            

            <code class="ruby">  # puts &quot;There are the following snakes: #{@snakes}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            
            

            

            <code class="ruby">  # Puts all the food in an array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="214">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @food = board[:board][:food] || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            
            

            

            <code class="ruby">   #puts &quot;There is food at: #{@food}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            
            

            

            <code class="ruby">  # Our health</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="218">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @health = board[:you][:health].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            
            

            

            <code class="ruby">  # Puts all the hazards in an array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="221">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @hazards = board[:board][:hazards] || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            
            

            

            <code class="ruby">  # puts &quot;There are hazards at: #{@hazards}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            
            

            

            <code class="ruby">  # Puts the snakes length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="225">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @length = board[:you][:length].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            
            

            

            <code class="ruby">  # puts &quot;My length is: #{@length}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            
            

            

            <code class="ruby">  # Puts the ruleset name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="229">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @game_mode = board[:game][:ruleset][:name]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            
            

            

            <code class="ruby">  # Puts the tail cells of all the snakes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="232">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @snake_tails = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="233">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @snakes.each do |snake|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="234">
            <span class="hits">13</span>
            

            

            <code class="ruby">    @snake_tails &lt;&lt; snake[:body][-1]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            
            

            

            <code class="ruby">  # My tail coordinates</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="238">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @my_tail = [{:x =&gt; board[:you][:body][-1][:x], :y =&gt; board[:you][:body][-1][:y]}]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            
            

            

            <code class="ruby">  #puts &quot;My tail is: #{@my_tail}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            
            

            

            <code class="ruby">  # Puts x, y coordinates hash of all cells on the board</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="242">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @board_hash = board[:board][:height].to_i.times.map do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="243">
            <span class="hits">66</span>
            

            

            <code class="ruby">    board[:board][:width].to_i.times.map do |j|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="244">
            <span class="hits">726</span>
            

            

            <code class="ruby">      { x: j, y: i }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            
            

            

            <code class="ruby">  end.flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            
            

            

            <code class="ruby">  # Puts x, y coordinates hash of my snake&#39;s head</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="249">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @head = board[:you][:head]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            
            

            

            <code class="ruby">  # Set @head x and y to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="251">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @head[:x] = @head[:x].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="252">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @head[:y] = @head[:y].to_i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            
            

            

            <code class="ruby">  # Puts x, y coordinates hash of my snake&#39;s body</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="255">
            <span class="hits">42</span>
            

            

            <code class="ruby">  @body = board[:you][:body].map { |b| { x: b[:x], y: b[:y] } }.flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            
            

            

            <code class="ruby">  # Puts where all other snakes bodies and heads are</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="258">
            <span class="hits">19</span>
            

            

            <code class="ruby">  @snakes_bodies = board[:board][:snakes].map { |s| s[:body] }.flatten + @body || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            
            

            

            <code class="ruby">  # Puts where all snakes heads are</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="261">
            <span class="hits">19</span>
            

            

            <code class="ruby">  @snakes_heads = board[:board][:snakes].map { |s| s[:head] }.flatten || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            
            

            

            <code class="ruby">  # Puts where all snakes heads are, but not my head</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="264">
            <span class="hits">19</span>
            

            

            <code class="ruby">  @snakes_heads_not_my_head = board[:board][:snakes].map { |s| s[:head] }.flatten - [@head] || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            
            

            

            <code class="ruby">  # Remove my head from the snakes heads</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="266">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @snakes_heads_not_my_head.delete(@head)  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            
            

            

            <code class="ruby">  # Puts where all snakes bodies are, but not my body</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="269">
            <span class="hits">19</span>
            

            

            <code class="ruby">  @snakes_bodies_not_my_body = board[:board][:snakes].map { |s| s[:body] }.flatten - @body || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            
            

            

            <code class="ruby">  # Remove my body from the snakes bodies</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="271">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @snakes_bodies_not_my_body.delete(@body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            
            

            

            <code class="ruby">  # Puts where all food cells which are also hazard cells</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="274">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @food_hazards = @food.select do |f|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="275">
            <span class="hits">24</span>
            

            

            <code class="ruby">    @hazards.any? do |h|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="441" data-linenumber="276">
            <span class="hits">441</span>
            

            

            <code class="ruby">      f[:x] == h[:x] &amp;&amp; f[:y] == h[:y]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            
            

            

            <code class="ruby">  # Function to determine x,y coordinate pair hash of each cell adjacent to the head</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="281">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def adjacent_cells(x, y)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            
            

            

            <code class="ruby">    # Set x and y coordinates to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1755" data-linenumber="283">
            <span class="hits">1755</span>
            

            

            <code class="ruby">    x = x.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1755" data-linenumber="284">
            <span class="hits">1755</span>
            

            

            <code class="ruby">    y = y.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1755" data-linenumber="285">
            <span class="hits">1755</span>
            

            

            <code class="ruby">    [{ x: x - 1, y: y }, { x: x + 1, y: y }, { x: x, y: y - 1 }, { x: x, y: y + 1 }]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            
            

            

            <code class="ruby">  # Function to determine x,y coordinate pair hash of each cell adjacent to the head within 3 cells</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="289">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def adjacent_cells_3(x, y)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            
            

            

            <code class="ruby">    # Set x and y coordinates to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="291">
            <span class="hits">6</span>
            

            

            <code class="ruby">    x = x.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="292">
            <span class="hits">6</span>
            

            

            <code class="ruby">    y = y.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="293">
            <span class="hits">6</span>
            

            

            <code class="ruby">    [{ x: x - 1, y: y }, { x: x + 1, y: y }, { x: x, y: y - 1 }, { x: x, y: y + 1 }, { x: x - 1, y: y - 1 }, { x: x - 1, y: y + 1 }, { x: x + 1, y: y - 1 }, { x: x + 1, y: y + 1 }]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            
            

            

            <code class="ruby">  # Food adjacent cells</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="297">
            <span class="hits">30</span>
            

            

            <code class="ruby">  @food_adjacent_cells = @food.map { |f| adjacent_cells(f[:x], f[:y]) }.flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="298">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="299">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @head_neighbors = adjacent_cells(@head[:x], @head[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="301">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @three_head_neighbors = adjacent_cells_3(@head[:x], @head[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="303">
            <span class="hits">13</span>
            

            

            <code class="ruby">  @other_snakes_head_neighbors = @snakes_heads_not_my_head.map { |s| adjacent_cells(s[:x], s[:y]) }.flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            
            

            

            <code class="ruby">  # Shared neighbors are cells which are in both @head_neighbors and @other_snakes_head_neighbors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="306">
            <span class="hits">30</span>
            

            

            <code class="ruby">  @shared_neighbors = @head_neighbors.select { |h| @other_snakes_head_neighbors.include?(h) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            
            

            

            <code class="ruby">  #puts &quot;Shared neighbors are: #{@shared_neighbors}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="309">
            
            

            

            <code class="ruby">  # Id, Name, total Lengths, Coordinates of all snakes heads</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="310">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @snakes_info = board[:board][:snakes].map do |s|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="311">
            <span class="hits">13</span>
            

            

            <code class="ruby">    { id: s[:id], name: s[:name], length: s[:body].length, head: s[:head],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            
            

            

            <code class="ruby">      head_neighbors: adjacent_cells(s[:head][:x], s[:head][:y]) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            
            

            

            <code class="ruby">  # My snake id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="316">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @id = board[:you][:id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            
            

            

            <code class="ruby">  # Puts where all heads of shorter snakes are</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="319">
            <span class="hits">19</span>
            

            

            <code class="ruby">  @shorter_snake_heads = board[:board][:snakes].map { |s| s[:head] }.flatten.select do |h|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="320">
            <span class="hits">13</span>
            

            

            <code class="ruby">    @snakes.any? do |s|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="321">
            <span class="hits">29</span>
            

            

            <code class="ruby">      s[:length] &lt; @length &amp;&amp; h[:x] == s[:head][:x] &amp;&amp; h[:y] == s[:head][:y]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="324">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            
            

            

            <code class="ruby">  # @shared_longer_snakes are cells which are in both @head_neighbors and @other_snakes_head_neighbors and where the length of the neighboring snake is longer than my snake</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="327">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @shared_longer_snakes = @shared_neighbors.select do |s|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="328">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @snakes.any? do |s|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="329">
            <span class="hits">3</span>
            

            

            <code class="ruby">      s[:length] &gt; @length &amp;&amp; s[:head][:x] == s[:head][:x] &amp;&amp; s[:head][:y] == s[:head][:y]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            
            

            

            <code class="ruby">  # @shared_shorter_snakes are cells which are in both @head_neighbors and @other_snakes_head_neighbors and where the length of the neighboring snake is shorter than my snake</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="334">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @shared_shorter_snakes = @shared_neighbors.select do |s|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="335">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @snakes.any? do |s|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="336">
            <span class="hits">6</span>
            

            

            <code class="ruby">      s[:length] &lt; @length &amp;&amp; s[:head][:x] == s[:head][:x] &amp;&amp; s[:head][:y] == s[:head][:y]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="337">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="338">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="339">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            
            

            

            <code class="ruby">  # @shared_same_length_snakes are cells which are in both @head_neighbors and @other_snakes_head_neighbors and where the length of the neighboring snake is the same as my snake</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="341">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @shared_same_length_snakes = @shared_neighbors.select do |s|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="342">
            <span class="hits">3</span>
            

            

            <code class="ruby">    @snakes.any? do |s|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="343">
            <span class="hits">6</span>
            

            

            <code class="ruby">      s[:length] == @length &amp;&amp; s[:head][:x] == s[:head][:x] &amp;&amp; s[:head][:y] == s[:head][:y]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="344">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="345">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="346">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="347">
            
            

            

            <code class="ruby">  # Each time the snake eats a piece of food, its tail grows longer, making the game increasingly difficult.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="348">
            
            

            

            <code class="ruby">  # The user controls the direction of the snake&#39;s head (up, down, left, or right), and the snake&#39;s body follows. The player cannot stop the snake from moving while the game is in progress.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="349">
            
            

            

            <code class="ruby">  # The board is a 2-dimensional array of cells, each cell containing a hash with x and y coordinates. The board is of variable size, and is surronded by walls.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="350">
            
            

            

            <code class="ruby">  # Other snakes and hazards are present on the board and should be avoided.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            
            

            

            <code class="ruby">  # The board is updated every turn.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="352">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="353">
            <span class="hits">19</span>
            

            

            <code class="ruby">  @my_snake = @snakes.select { |s| s[:id] == board[:you][:id] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="354">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="355">
            
            

            

            <code class="ruby">  # Function to check if a cell is a wall</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="356">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def is_wall?(x, y)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="357">
            
            

            

            <code class="ruby">    # If game mode is wrapped, set false, else perform wall check</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="358">
            <span class="hits">726</span>
            

            

            <code class="ruby">    if @game_mode == &#39;wrapped&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="359">
            
            

            

            <code class="ruby">      false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="360">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="361">
            <span class="hits">726</span>
            

            

            <code class="ruby">      if x.negative? || y.negative? || x &gt;= @width || y &gt;= @height</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="362">
            
            

            

            <code class="ruby">        true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="363">
            
            

            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="364">
            <span class="hits">726</span>
            

            

            <code class="ruby">        false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="365">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="366">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="368">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="369">
            
            

            

            <code class="ruby">  # Function to check if a cell is a snake body</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="370">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def is_snake?(x, y)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="371">
            
            

            

            <code class="ruby">    @snakes_bodies.select { |c| c[:x] == x &amp;&amp; c[:y] == y }.empty? &amp;&amp; @snakes_heads.select do |c|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="372">
            
            

            

            <code class="ruby">      c[:x] == x &amp;&amp; c[:y] == y</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="373">
            
            

            

            <code class="ruby">    end.empty? &amp;&amp; @body.select do |c|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="374">
            
            

            

            <code class="ruby">                    c[:x] == x &amp;&amp; c[:y] == y</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="375">
            
            

            

            <code class="ruby">                  end.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="376">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="377">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="378">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @all_occupied_cells = (@snakes_heads + @snakes_bodies + @head.to_a + @body).flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="379">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            
            

            

            <code class="ruby">  # x, y coordinates hash of all empty cells on the board</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="381">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @empty_cells = @board_hash - @all_occupied_cells + @food</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="382">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="383">
            
            

            

            <code class="ruby">  # x, y coordinates of each corner cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="384">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @corners = [{ x: 0, y: 0 }, { x: @width - 1, y: 0 }, { x: 0, y: @height - 1 },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="385">
            
            

            

            <code class="ruby">              { x: @width - 1, y: @height - 1 }]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="386">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="387">
            
            

            

            <code class="ruby">  # x, y coordinates array of every cell around the edge of the board</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="138" data-linenumber="388">
            <span class="hits">138</span>
            

            

            <code class="ruby">  @edges = @width.times.map { |x| [{ x: x, y: 0 }, { x: x, y: @height - 1 }] }.flatten + @height.times.map do |y| [{ x: 0, y: y }, { x: @width - 1, y: y }] end.flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            
            

            

            <code class="ruby">  # x, y coordinates array of every cell adjacent to cells on the edge of the board</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="391">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @edge_adjacent_cells = @edges.each_with_object([]) do |e, a|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="264" data-linenumber="392">
            <span class="hits">264</span>
            

            

            <code class="ruby">    a &lt;&lt; adjacent_cells(e[:x], e[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="393">
            
            

            

            <code class="ruby">  end.flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="394">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="395">
            
            

            

            <code class="ruby">  # x, y coordinates array of every cell adjacent to hazard cells</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="396">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @hazard_adjacent_cells = @hazards.each_with_object([]) do |h, a|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="125" data-linenumber="397">
            <span class="hits">125</span>
            

            

            <code class="ruby">    a &lt;&lt; adjacent_cells(h[:x], h[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="398">
            
            

            

            <code class="ruby">  end.flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="399">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="400">
            
            

            

            <code class="ruby">  # Cells within 1 cell of any snake body</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="132" data-linenumber="401">
            <span class="hits">132</span>
            

            

            <code class="ruby">  @snakes_bodies_neighbors = @snakes_bodies.map { |s| adjacent_cells(s[:x], s[:y]) }.flatten</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="402">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="403">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="404">
            
            

            

            <code class="ruby">  # Function to determine the direction between two cell x,y coordinates from the perspective of the snake</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="405">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def direction_between(x1, y1, x2, y2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="406">
            
            

            

            <code class="ruby">    # Set values to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="734" data-linenumber="407">
            <span class="hits">734</span>
            

            

            <code class="ruby">    x1 = x1.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="734" data-linenumber="408">
            <span class="hits">734</span>
            

            

            <code class="ruby">    y1 = y1.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="734" data-linenumber="409">
            <span class="hits">734</span>
            

            

            <code class="ruby">    x2 = x2.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="734" data-linenumber="410">
            <span class="hits">734</span>
            

            

            <code class="ruby">    y2 = y2.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="734" data-linenumber="411">
            <span class="hits">734</span>
            

            

            <code class="ruby">    if x1 &lt; x2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="421" data-linenumber="412">
            <span class="hits">421</span>
            

            

            <code class="ruby">      &#39;right&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="313" data-linenumber="413">
            <span class="hits">313</span>
            

            

            <code class="ruby">    elsif x1 &gt; x2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="247" data-linenumber="414">
            <span class="hits">247</span>
            

            

            <code class="ruby">      &#39;left&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="415">
            <span class="hits">66</span>
            

            

            <code class="ruby">    elsif y1 &lt; y2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="416">
            <span class="hits">43</span>
            

            

            <code class="ruby">      &#39;up&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="417">
            <span class="hits">23</span>
            

            

            <code class="ruby">    elsif y1 &gt; y2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="418">
            <span class="hits">17</span>
            

            

            <code class="ruby">      &#39;down&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="419">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="420">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="421">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="422">
            
            

            

            <code class="ruby">  # Function to determine the two possible directions between two cell x,y coordinates from the perspective of the snake (x1, y1)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="423">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def possible_directions_between(x1, y1, x2, y2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="424">
            
            

            

            <code class="ruby">    # Set values to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="425">
            <span class="hits">726</span>
            

            

            <code class="ruby">    x1 = x1.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="426">
            <span class="hits">726</span>
            

            

            <code class="ruby">    y1 = y1.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="427">
            <span class="hits">726</span>
            

            

            <code class="ruby">    x2 = x2.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="428">
            <span class="hits">726</span>
            

            

            <code class="ruby">    y2 = y2.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="429">
            <span class="hits">726</span>
            

            

            <code class="ruby">    if x1 &lt; x2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="418" data-linenumber="430">
            <span class="hits">418</span>
            

            

            <code class="ruby">      if y1 &lt; y2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="431">
            <span class="hits">326</span>
            

            

            <code class="ruby">        %w[right up]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="432">
            <span class="hits">92</span>
            

            

            <code class="ruby">      elsif y1 &gt; y2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="433">
            <span class="hits">54</span>
            

            

            <code class="ruby">        %w[right down]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="434">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="308" data-linenumber="435">
            <span class="hits">308</span>
            

            

            <code class="ruby">    elsif x1 &gt; x2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="436">
            <span class="hits">242</span>
            

            

            <code class="ruby">      if y1 &lt; y2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="104" data-linenumber="437">
            <span class="hits">104</span>
            

            

            <code class="ruby">        %w[left down]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="138" data-linenumber="438">
            <span class="hits">138</span>
            

            

            <code class="ruby">      elsif y1 &gt; y2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="116" data-linenumber="439">
            <span class="hits">116</span>
            

            

            <code class="ruby">        %w[left up]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="440">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="441">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="442">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="443">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="444">
            
            

            

            <code class="ruby">  # Function to determine the opposite direction between two cell x,y coordinates from the perspective of the snake</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="445">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def opposite_direction(x1, y1, x2, y2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="446">
            
            

            

            <code class="ruby">    # Set values to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="447">
            <span class="hits">726</span>
            

            

            <code class="ruby">    x1 = x1.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="448">
            <span class="hits">726</span>
            

            

            <code class="ruby">    y1 = y1.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="449">
            <span class="hits">726</span>
            

            

            <code class="ruby">    x2 = x2.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="450">
            <span class="hits">726</span>
            

            

            <code class="ruby">    y2 = y2.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="451">
            <span class="hits">726</span>
            

            

            <code class="ruby">    if x1 &lt; x2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="418" data-linenumber="452">
            <span class="hits">418</span>
            

            

            <code class="ruby">      &#39;left&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="308" data-linenumber="453">
            <span class="hits">308</span>
            

            

            <code class="ruby">    elsif x1 &gt; x2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="454">
            <span class="hits">242</span>
            

            

            <code class="ruby">      &#39;right&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="455">
            <span class="hits">66</span>
            

            

            <code class="ruby">    elsif y1 &lt; y2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="456">
            <span class="hits">43</span>
            

            

            <code class="ruby">      &#39;down&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="457">
            <span class="hits">23</span>
            

            

            <code class="ruby">    elsif y1 &gt; y2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="458">
            <span class="hits">17</span>
            

            

            <code class="ruby">      &#39;up&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="459">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="460">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="461">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="462">
            
            

            

            <code class="ruby">  # Invert directions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="463">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def invert_direction(direction)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="464">
            
            

            

            <code class="ruby">    case direction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="465">
            
            

            

            <code class="ruby">    when &#39;up&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="466">
            
            

            

            <code class="ruby">      &#39;down&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="467">
            
            

            

            <code class="ruby">    when &#39;down&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="468">
            
            

            

            <code class="ruby">      &#39;up&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="469">
            
            

            

            <code class="ruby">    when &#39;left&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="470">
            
            

            

            <code class="ruby">      &#39;right&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="471">
            
            

            

            <code class="ruby">    when &#39;right&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="472">
            
            

            

            <code class="ruby">      &#39;left&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="473">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="474">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="475">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="476">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="477">
            
            

            

            <code class="ruby">  # Given an x,y coordinate on the edge of the board, return the x,y coordinates of the cell on the opposite side of the board</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="478">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def opposite_edge_cell(x, y)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="479">
            
            

            

            <code class="ruby">    # Set values to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="480">
            
            

            

            <code class="ruby">    x = x.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="481">
            
            

            

            <code class="ruby">    y = y.to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="482">
            
            

            

            <code class="ruby">    if x == 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="483">
            
            

            

            <code class="ruby">      { x: @width - 1, y: y }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="484">
            
            

            

            <code class="ruby">    elsif x == @width - 1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="485">
            
            

            

            <code class="ruby">      { x: 0, y: y }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="486">
            
            

            

            <code class="ruby">    elsif y == 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="487">
            
            

            

            <code class="ruby">      { x: x, y: @height - 1 }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="488">
            
            

            

            <code class="ruby">    elsif y == @height - 1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="489">
            
            

            

            <code class="ruby">      { x: x, y: 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="490">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="491">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="492">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="493">
            
            

            

            <code class="ruby">  # Function to find the neighbors of a given cell x,y coordinates</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="494">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def neighbors_of(x, y)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="495">
            <span class="hits">726</span>
            

            

            <code class="ruby">    adjacent_cells(x, y)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="496">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="497">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="498">
            
            

            

            <code class="ruby">  # My tail neighbors are the cells adjacent to my tail</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="499">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @my_tail_neighbors = adjacent_cells(@my_tail.first[:x], @my_tail.first[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="500">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="501">
            
            

            

            <code class="ruby">  # Cell base score</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="502">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @cell_base_score = 1000</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="503">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="504">
            
            

            

            <code class="ruby">  # Initialize score multiplier first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="505">
            <span class="hits">6</span>
            

            

            <code class="ruby">  if @game_mode == &#39;wrapped&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="506">
            
            

            

            <code class="ruby">    #puts &#39;@@@ Using wrapped game mode score multiplier&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="507">
            
            

            

            <code class="ruby">    @score_multiplier = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="508">
            
            

            

            <code class="ruby">      &#39;wall&#39; =&gt; 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="509">
            
            

            

            <code class="ruby">      &#39;hazard&#39; =&gt; -550,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="510">
            
            

            

            <code class="ruby">      &#39;hazard_adjacent&#39; =&gt; 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="511">
            
            

            

            <code class="ruby">      &#39;food&#39; =&gt; 55,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="512">
            
            

            

            <code class="ruby">      &#39;food_hazard&#39; =&gt; 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="513">
            
            

            

            <code class="ruby">      &#39;food_adjacent&#39; =&gt; 20,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="514">
            
            

            

            <code class="ruby">      &#39;shared_neighbor&#39; =&gt; 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="515">
            
            

            

            <code class="ruby">      &#39;shared_shorter_snake&#39; =&gt; 45,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="516">
            
            

            

            <code class="ruby">      &#39;shared_longer_snake&#39; =&gt; -80,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="517">
            
            

            

            <code class="ruby">      &#39;shared_same_length_snake&#39; =&gt; -75,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="518">
            
            

            

            <code class="ruby">      &#39;empty&#39; =&gt; 55,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="519">
            
            

            

            <code class="ruby">      &#39;snake_head&#39; =&gt; -2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="520">
            
            

            

            <code class="ruby">      &#39;snake_body&#39; =&gt; -2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="521">
            
            

            

            <code class="ruby">      &#39;snake_body_neighbor&#39; =&gt; -20,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="522">
            
            

            

            <code class="ruby">      &#39;corner&#39; =&gt; -1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="523">
            
            

            

            <code class="ruby">      &#39;other_snake_head&#39; =&gt; -2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="524">
            
            

            

            <code class="ruby">      &#39;other_snake_body&#39; =&gt; -30,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="525">
            
            

            

            <code class="ruby">      &#39;other_snake_head_neighbor&#39; =&gt; -0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="526">
            
            

            

            <code class="ruby">      &#39;body&#39; =&gt; -100,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="527">
            
            

            

            <code class="ruby">      &#39;head&#39; =&gt; -4,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="528">
            
            

            

            <code class="ruby">      &#39;tail&#39; =&gt; 2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="529">
            
            

            

            <code class="ruby">      &#39;my_tail&#39; =&gt; 6,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="530">
            
            

            

            <code class="ruby">      &#39;my_tail_neighbor&#39; =&gt; 20,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="531">
            
            

            

            <code class="ruby">      &#39;edge&#39; =&gt; 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="532">
            
            

            

            <code class="ruby">      &#39;edge_adjacent&#39; =&gt; 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="533">
            
            

            

            <code class="ruby">      &#39;head_neighbor&#39; =&gt; 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="534">
            
            

            

            <code class="ruby">      &#39;three_head_neighbor&#39; =&gt; -2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="535">
            
            

            

            <code class="ruby">      &#39;shorter_snake_heads&#39; =&gt; 4</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="536">
            
            

            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="537">
            
            

            

            <code class="ruby">  else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="538">
            
            

            

            <code class="ruby">    # Set score multiplier for each type of cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="539">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @score_multiplier = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="540">
            
            

            

            <code class="ruby">      &#39;wall&#39; =&gt; -5,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="541">
            
            

            

            <code class="ruby">      &#39;hazard&#39; =&gt; -15,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="542">
            
            

            

            <code class="ruby">      &#39;hazard_adjacent&#39; =&gt; -7,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="543">
            
            

            

            <code class="ruby">      &#39;food&#39; =&gt; 15,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="544">
            
            

            

            <code class="ruby">      &#39;food_hazard&#39; =&gt; 2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="545">
            
            

            

            <code class="ruby">      &#39;food_adjacent&#39; =&gt; 2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="546">
            
            

            

            <code class="ruby">      &#39;shared_neighbor&#39; =&gt; 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="547">
            
            

            

            <code class="ruby">      &#39;shared_shorter_snake&#39; =&gt; 5,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="548">
            
            

            

            <code class="ruby">      &#39;shared_longer_snake&#39; =&gt; -50,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="549">
            
            

            

            <code class="ruby">      &#39;shared_same_length_snake&#39; =&gt; -5,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="550">
            
            

            

            <code class="ruby">      &#39;empty&#39; =&gt; 8,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="551">
            
            

            

            <code class="ruby">      &#39;snake_head&#39; =&gt; -2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="552">
            
            

            

            <code class="ruby">      &#39;snake_body&#39; =&gt; -2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="553">
            
            

            

            <code class="ruby">      &#39;snake_body_neighbor&#39; =&gt; -10,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="554">
            
            

            

            <code class="ruby">      &#39;corner&#39; =&gt; -1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="555">
            
            

            

            <code class="ruby">      &#39;other_snake_head&#39; =&gt; -2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="556">
            
            

            

            <code class="ruby">      &#39;other_snake_body&#39; =&gt; -130,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="557">
            
            

            

            <code class="ruby">      &#39;other_snake_head_neighbor&#39; =&gt; -0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="558">
            
            

            

            <code class="ruby">      &#39;body&#39; =&gt; -5,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="559">
            
            

            

            <code class="ruby">      &#39;head&#39; =&gt; -4,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="560">
            
            

            

            <code class="ruby">      &#39;tail&#39; =&gt; 2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="561">
            
            

            

            <code class="ruby">      &#39;my_tail&#39; =&gt; 76,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="562">
            
            

            

            <code class="ruby">      &#39;my_tail_neighbor&#39; =&gt; 12,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="563">
            
            

            

            <code class="ruby">      &#39;edge&#39; =&gt; -4,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="564">
            
            

            

            <code class="ruby">      &#39;edge_adjacent&#39; =&gt; -1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="565">
            
            

            

            <code class="ruby">      &#39;head_neighbor&#39; =&gt; 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="566">
            
            

            

            <code class="ruby">      &#39;three_head_neighbor&#39; =&gt; -2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="567">
            
            

            

            <code class="ruby">      &#39;shorter_snake_heads&#39; =&gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="568">
            
            

            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="569">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="570">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="571">
            
            

            

            <code class="ruby">  # Dynamic scoring based on game state - adjust after initialization</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="572">
            <span class="hits">26</span>
            

            

            <code class="ruby">  longest_enemy = @snakes.reject { |s| s[:id] == @id }.max_by { |s| s[:length] }&amp;.dig(:length) || 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="573">
            <span class="hits">6</span>
            

            

            <code class="ruby">  winning_by = @length - longest_enemy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="574">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="575">
            
            

            

            <code class="ruby">  # If we&#39;re winning by a lot, be more conservative</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="576">
            <span class="hits">6</span>
            

            

            <code class="ruby">  if winning_by &gt;= 3</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="577">
            
            

            

            <code class="ruby">    @score_multiplier[&#39;edge&#39;] = -8</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="578">
            
            

            

            <code class="ruby">    @score_multiplier[&#39;corner&#39;] = -5</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="579">
            
            

            

            <code class="ruby">    @score_multiplier[&#39;food&#39;] = 5  # Less aggressive about food</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="580">
            
            

            

            <code class="ruby">    @score_multiplier[&#39;my_tail_neighbor&#39;] = 25  # More tail following</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="581">
            
            

            

            <code class="ruby">    puts &quot;Playing conservatively - winning by #{winning_by}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="582">
            <span class="hits">6</span>
            

            

            <code class="ruby">  elsif winning_by &lt;= -2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="583">
            
            

            

            <code class="ruby">    # If we&#39;re losing, be more aggressive</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="584">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @score_multiplier[&#39;food&#39;] = 30</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="585">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @score_multiplier[&#39;shared_shorter_snake&#39;] = 15</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="586">
            <span class="hits">4</span>
            

            

            <code class="ruby">    @score_multiplier[&#39;edge&#39;] = -2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="587">
            <span class="hits">4</span>
            

            

            <code class="ruby">    puts &quot;Playing aggressively - losing by #{-winning_by}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="588">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="589">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="590">
            
            

            

            <code class="ruby">  # Create an array of all of this turn&#39;s cells. Each cell is a hash with x and y coordinates, a set of types, and the direction of the cell realative to the snake&#39;s head.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="591">
            
            

            

            <code class="ruby">  # A cell may have multiple types, such as a wall, a hazard, a food, a food_hazard, a shared_neighbor, a snake body, or a snake head.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="592">
            
            

            

            <code class="ruby">  # The direction is the direction of the cell relative to the snake&#39;s head.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="593">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="594">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @turn_score_array = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="595">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @board_hash.each do |cell|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="596">
            
            

            

            <code class="ruby">    # Check what types this cell&#39;s x and y coordinates are</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="597">
            <span class="hits">726</span>
            

            

            <code class="ruby">    types = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="598">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="599">
            
            

            

            <code class="ruby">    # Check if the cell is a wall</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="600">
            <span class="hits">726</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;wall&#39; if is_wall?(cell[:x], cell[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3630" data-linenumber="601">
            <span class="hits">3630</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;corner&#39; if @corners.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2299" data-linenumber="602">
            <span class="hits">2299</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;other_snake_head&#39; if @snakes_heads.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15972" data-linenumber="603">
            <span class="hits">15972</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;other_snake_body&#39; if @snakes_bodies.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5082" data-linenumber="604">
            <span class="hits">5082</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;body&#39; if @body.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2299" data-linenumber="605">
            <span class="hits">2299</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;tail&#39; if @snake_tails.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1452" data-linenumber="606">
            <span class="hits">1452</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;my_tail&#39; if @my_tail.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3630" data-linenumber="607">
            <span class="hits">3630</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;my_tail_neighbor&#39; if @my_tail_neighbors.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="608">
            
            

            

            <code class="ruby">    # types &lt;&lt; &#39;head&#39; if @head.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3630" data-linenumber="609">
            <span class="hits">3630</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;food&#39; if @food.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2299" data-linenumber="610">
            <span class="hits">2299</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;food_hazard&#39; if @food_hazards.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15851" data-linenumber="611">
            <span class="hits">15851</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;hazard&#39; if @hazards.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1089" data-linenumber="612">
            <span class="hits">1089</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;shared_neighbor&#39; if @shared_neighbors.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="613">
            <span class="hits">726</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;shared_shorter_snake&#39; if @shared_shorter_snakes.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1089" data-linenumber="614">
            <span class="hits">1089</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;shared_longer_snake&#39; if @shared_longer_snakes.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="615">
            <span class="hits">726</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;shared_same_length_snake&#39; if @shared_same_length_snakes.select do |c|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="363" data-linenumber="616">
            <span class="hits">363</span>
            

            

            <code class="ruby">                                             c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="617">
            
            

            

            <code class="ruby">                                           end.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="80223" data-linenumber="618">
            <span class="hits">80223</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;empty&#39; if @empty_cells.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3630" data-linenumber="619">
            <span class="hits">3630</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;head_neighbor&#39; if @head_neighbors.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32670" data-linenumber="620">
            <span class="hits">32670</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;edge&#39; if @edges.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4114" data-linenumber="621">
            <span class="hits">4114</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;other_snake_head_neighbor&#39; if @other_snakes_head_neighbors.select do |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] end.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61710" data-linenumber="622">
            <span class="hits">61710</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;snake_body_neighbor&#39; if @snakes_bodies_neighbors.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12342" data-linenumber="623">
            <span class="hits">12342</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;food_adjacent&#39; if @food_adjacent_cells.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61226" data-linenumber="624">
            <span class="hits">61226</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;hazard_adjacent&#39; if @hazard_adjacent_cells.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="128502" data-linenumber="625">
            <span class="hits">128502</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;edge_adjacent&#39; if @edge_adjacent_cells.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6534" data-linenumber="626">
            <span class="hits">6534</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;three_head_neighbor&#39; if @three_head_neighbors.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="627">
            <span class="hits">726</span>
            

            

            <code class="ruby">    types &lt;&lt; &#39;shorter_snake_heads&#39; if @shorter_snake_heads.select { |c| c[:x] == cell[:x] &amp;&amp; c[:y] == cell[:y] }.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="628">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="629">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="630">
            
            

            

            <code class="ruby">    # Determine the direction between this cell and the snake&#39;s head</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="631">
            <span class="hits">726</span>
            

            

            <code class="ruby">    direction = direction_between(@head[:x], @head[:y], cell[:x], cell[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="632">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="633">
            
            

            

            <code class="ruby">    # Determine the opposite direction between this cell and the snake&#39;s head</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="634">
            <span class="hits">726</span>
            

            

            <code class="ruby">    opposite_direction = opposite_direction(@head[:x], @head[:y], cell[:x], cell[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="635">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="636">
            
            

            

            <code class="ruby">    # Determine the possible directions between this cell and the snake&#39;s head</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="637">
            <span class="hits">726</span>
            

            

            <code class="ruby">    possible_directions = possible_directions_between(@head[:x], @head[:y], cell[:x], cell[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="638">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="639">
            
            

            

            <code class="ruby">    # Determine the neighbors of this cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="640">
            <span class="hits">726</span>
            

            

            <code class="ruby">    neighbors = neighbors_of(cell[:x], cell[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="641">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="642">
            
            

            

            <code class="ruby">    # Add x, y coordinates, types, and direction to the cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="643">
            <span class="hits">726</span>
            

            

            <code class="ruby">    cell[:x] = cell[:x]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="644">
            <span class="hits">726</span>
            

            

            <code class="ruby">    cell[:y] = cell[:y]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="645">
            <span class="hits">726</span>
            

            

            <code class="ruby">    cell[:types] = types</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="646">
            
            

            

            <code class="ruby">    # Each cell has a score, which is the sum of the @cell_base_score and score_multiplier for each type of cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="647">
            <span class="hits">726</span>
            

            

            <code class="ruby">    cell[:score] = if types.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="648">
            <span class="hits">726</span>
            

            

            <code class="ruby">                     types.map do |type|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2270" data-linenumber="649">
            <span class="hits">2270</span>
            

            

            <code class="ruby">                       @score_multiplier[type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="650">
            
            

            

            <code class="ruby">                     end.reduce(:+) + @cell_base_score</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="651">
            
            

            

            <code class="ruby">                   else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="652">
            
            

            

            <code class="ruby">                     @cell_base_score</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="653">
            
            

            

            <code class="ruby">                   end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="654">
            <span class="hits">726</span>
            

            

            <code class="ruby">    cell[:direction] = direction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="655">
            <span class="hits">726</span>
            

            

            <code class="ruby">    cell[:possible_directions] = possible_directions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="656">
            <span class="hits">726</span>
            

            

            <code class="ruby">    cell[:opposite_direction] = opposite_direction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="657">
            <span class="hits">726</span>
            

            

            <code class="ruby">    cell[:neighbors] = neighbors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="658">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="659">
            
            

            

            <code class="ruby">    # Add the cell to the turn_score_array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="660">
            <span class="hits">726</span>
            

            

            <code class="ruby">    @turn_score_array &lt;&lt; cell</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="661">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="662">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="663">
            
            

            

            <code class="ruby">  # puts &quot;Turn score array is: #{@turn_score_array}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="664">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="665">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="666">
            
            

            

            <code class="ruby">  # Direction of highest score cell in the @turn_score_array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="732" data-linenumber="667">
            <span class="hits">732</span>
            

            

            <code class="ruby">  @highest_score_direction = @turn_score_array.max_by { |cell| cell[:score] }[:direction]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="668">
            <span class="hits">6</span>
            

            

            <code class="ruby">  puts &quot;Highest score cell direction is: #{@highest_score_direction}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="669">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="670">
            
            

            

            <code class="ruby">  # If our @health is above the @health_threshold, set the multiplier to 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="671">
            
            

            

            <code class="ruby">  # If our @health is below the @health_threshold, set the multiplier to 2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="672">
            <span class="hits">6</span>
            

            

            <code class="ruby">  if @health &gt; @health_threshold</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="673">
            
            

            

            <code class="ruby">    @top_direction_score_multiplier = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="674">
            
            

            

            <code class="ruby">  else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="675">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @top_direction_score_multiplier = 15</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="676">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="677">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="678">
            
            

            

            <code class="ruby">  # For every cell in the turn_score_array, add types &#39;top_direction&#39; if the cell&#39;s direction is the same as @highest_score_direction and increase the score by @top_direction_score_multiplier</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="679">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @turn_score_array.each do |cell|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="680">
            <span class="hits">726</span>
            

            

            <code class="ruby">    cell[:types] &lt;&lt; &#39;top_direction&#39; if cell[:direction] == @highest_score_direction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="726" data-linenumber="681">
            <span class="hits">726</span>
            

            

            <code class="ruby">    cell[:score] += @top_direction_score_multiplier if cell[:types].include?(&#39;top_direction&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="682">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="683">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="684">
            
            

            

            <code class="ruby">  # For each direction, find the number of empty or food cells in that direction, and the total score of all cells in that direction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="685">
            
            

            

            <code class="ruby">  # takes the @@turn_score_array as input</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="686">
            <span class="hits">6</span>
            

            

            <code class="ruby">  def direction_scores(turn_score_array)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="687">
            
            

            

            <code class="ruby">    # Sum the score of each cell for each direction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="688">
            
            

            

            <code class="ruby">    @direction_scores = {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="689">
            
            

            

            <code class="ruby">      &#39;left&#39; =&gt; turn_score_array.select { |cell| cell[:direction] == &#39;left&#39; }.map { |cell| cell[:score] }.reduce(:+),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="690">
            
            

            

            <code class="ruby">      &#39;right&#39; =&gt; turn_score_array.select { |cell| cell[:direction] == &#39;right&#39; }.map { |cell| cell[:score] }.reduce(:+),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="691">
            
            

            

            <code class="ruby">      &#39;up&#39; =&gt; turn_score_array.select { |cell| cell[:direction] == &#39;up&#39; }.map { |cell| cell[:score] }.reduce(:+),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="692">
            
            

            

            <code class="ruby">      &#39;down&#39; =&gt; turn_score_array.select { |cell| cell[:direction] == &#39;down&#39; }.map { |cell| cell[:score] }.reduce(:+)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="693">
            
            

            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="694">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="695">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="696">
            
            

            

            <code class="ruby">    # For each possible direction, find the number of empty or food cells in that direction, and the total score of all cells in that direction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="697">
            <span class="hits">6</span>
            

            

            <code class="ruby">    def direction_scores_possible(turn_score_array)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="698">
            
            

            

            <code class="ruby">      # Sum the score of each cell for each direction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="699">
            
            

            

            <code class="ruby">      @direction_scores_possible = {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="700">
            
            

            

            <code class="ruby">        &#39;left&#39; =&gt; turn_score_array.select { |cell| cell[:possible_directions].include?(&#39;left&#39;) }.map { |cell| cell[:score] }.reduce(:+),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="701">
            
            

            

            <code class="ruby">        &#39;right&#39; =&gt; turn_score_array.select { |cell| cell[:possible_directions].include?(&#39;right&#39;) }.map { |cell| cell[:score] }.reduce(:+),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="702">
            
            

            

            <code class="ruby">        &#39;up&#39; =&gt; turn_score_array.select { |cell| cell[:possible_directions].include?(&#39;up&#39;) }.map { |cell| cell[:score] }.reduce(:+),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="703">
            
            

            

            <code class="ruby">        &#39;down&#39; =&gt; turn_score_array.select { |cell| cell[:possible_directions].include?(&#39;down&#39;) }.map { |cell| cell[:score] }.reduce(:+)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="704">
            
            

            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="705">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="706">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="707">
            
            

            

            <code class="ruby">    # For each set of two possible directions, find the number of empty or food cells in that set of directions, and the total score of all cells in that direction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="708">
            <span class="hits">6</span>
            

            

            <code class="ruby">    def direction_scores_possible_2(turn_score_array)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="709">
            
            

            

            <code class="ruby">      # Sum the score of each cell for each direction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="710">
            
            

            

            <code class="ruby">      @direction_scores_possible_2 = {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="711">
            
            

            

            <code class="ruby">        &#39;left_up&#39; =&gt; turn_score_array.select { |cell| cell[:possible_directions].include?(&#39;left&#39;) &amp;&amp; cell[:possible_directions].include?(&#39;up&#39;) }.map { |cell| cell[:score] }.reduce(:+),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="712">
            
            

            

            <code class="ruby">        &#39;left_down&#39; =&gt; turn_score_array.select { |cell| cell[:possible_directions].include?(&#39;left&#39;) &amp;&amp; cell[:possible_directions].include?(&#39;down&#39;) }.map { |cell| cell[:score] }.reduce(:+),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="713">
            
            

            

            <code class="ruby">        &#39;right_up&#39; =&gt; turn_score_array.select { |cell| cell[:possible_directions].include?(&#39;right&#39;) &amp;&amp; cell[:possible_directions].include?(&#39;up&#39;) }.map { |cell| cell[:score] }.reduce(:+),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="714">
            
            

            

            <code class="ruby">        &#39;right_down&#39; =&gt; turn_score_array.select { |cell| cell[:possible_directions].include?(&#39;right&#39;) &amp;&amp; cell[:possible_directions].include?(&#39;down&#39;) }.map { |cell| cell[:score] }.reduce(:+)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="715">
            
            

            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="716">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="717">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="718">
            <span class="hits">6</span>
            

            

            <code class="ruby">  @possible_turns = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="719">
            
            

            

            <code class="ruby">  # Select my possible turns from the @turn_score_array. A possible turn is a direction to a head_neighbor that has a score greater than 0.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="732" data-linenumber="720">
            <span class="hits">732</span>
            

            

            <code class="ruby">  @turn_score_array.select { |cell| cell[:types].include?(&#39;head_neighbor&#39;) &amp;&amp; (cell[:score]).positive? }.each do |cell|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="721">
            <span class="hits">19</span>
            

            

            <code class="ruby">    @possible_turns &lt;&lt; cell</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="722">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="723">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="724">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="725">
            
            

            

            <code class="ruby">  # If game mode is &#39;wrapped&#39;, if our head is on the edge of the map, find the cell on the opposite side of the map and add it to the @possible_turns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="726">
            <span class="hits">6</span>
            

            

            <code class="ruby">  if @game_mode == &#39;wrapped&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="727">
            
            

            

            <code class="ruby">    if @head[:x] == 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="728">
            
            

            

            <code class="ruby">      opposite_edge = opposite_edge_cell(@head[:x], @head[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="729">
            
            

            

            <code class="ruby">      @turn_score_array.select { |cell| cell[:x] == opposite_edge[:x] &amp;&amp; cell[:y] == opposite_edge[:y] &amp;&amp; (cell[:score]).positive? }.each do |cell|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="730">
            
            

            

            <code class="ruby">        # invert the direction of the cell</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="731">
            
            

            

            <code class="ruby">        cell[:direction] = invert_direction(cell[:direction])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="732">
            
            

            

            <code class="ruby">        @possible_turns &lt;&lt; cell</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="733">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="734">
            
            

            

            <code class="ruby">    elsif @head[:x] == @width - 1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="735">
            
            

            

            <code class="ruby">      opposite_edge = opposite_edge_cell(@head[:x], @head[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="736">
            
            

            

            <code class="ruby">      @turn_score_array.select { |cell| cell[:x] == opposite_edge[:x] &amp;&amp; cell[:y] == opposite_edge[:y] &amp;&amp; (cell[:score]).positive? }.each do |cell|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="737">
            
            

            

            <code class="ruby">        # invert the direction of the cell</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="738">
            
            

            

            <code class="ruby">        cell[:direction] = invert_direction(cell[:direction])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="739">
            
            

            

            <code class="ruby">        @possible_turns &lt;&lt; cell</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="740">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="741">
            
            

            

            <code class="ruby">    elsif @head[:y] == 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="742">
            
            

            

            <code class="ruby">      opposite_edge = opposite_edge_cell(@head[:x], @head[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="743">
            
            

            

            <code class="ruby">      @turn_score_array.select { |cell| cell[:x] == opposite_edge[:x] &amp;&amp; cell[:y] == opposite_edge[:y] &amp;&amp; (cell[:score]).positive? }.each do |cell|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="744">
            
            

            

            <code class="ruby">        # invert the direction of the cell</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="745">
            
            

            

            <code class="ruby">        cell[:direction] = invert_direction(cell[:direction])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="746">
            
            

            

            <code class="ruby">        @possible_turns &lt;&lt; cell</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="747">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="748">
            
            

            

            <code class="ruby">    elsif @head[:y] == @height - 1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="749">
            
            

            

            <code class="ruby">      opposite_edge = opposite_edge_cell(@head[:x], @head[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="750">
            
            

            

            <code class="ruby">      @turn_score_array.select { |cell| cell[:x] == opposite_edge[:x] &amp;&amp; cell[:y] == opposite_edge[:y] &amp;&amp; (cell[:score]).positive? }.each do |cell|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="751">
            
            

            

            <code class="ruby">        # invert the direction of the cell</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="752">
            
            

            

            <code class="ruby">        cell[:direction] = invert_direction(cell[:direction])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="753">
            
            

            

            <code class="ruby">        @possible_turns &lt;&lt; cell</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="754">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="755">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="756">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="757">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="758">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="759">
            
            

            

            <code class="ruby">  # Load directions in @possible_turns into @possible_moves</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="760">
            <span class="hits">25</span>
            

            

            <code class="ruby">  @possible_moves = @possible_turns.map { |cell| cell[:direction] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="761">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="762">
            
            

            

            <code class="ruby">  # @possible_moves = [&#39;up&#39;, &#39;down&#39;, &#39;left&#39;, &#39;right&#39;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="763">
            
            

            

            <code class="ruby">  # If head is at edge of board, then remove the direction from @possible_moves</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="764">
            <span class="hits">6</span>
            

            

            <code class="ruby">  if @game_mode != &#39;wrapped&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="765">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @possible_moves.delete(&#39;left&#39;) if (@head[:x]).zero?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="766">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @possible_moves.delete(&#39;right&#39;) if @head[:x] == @width - 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="767">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @possible_moves.delete(&#39;down&#39;) if (@head[:y]).zero?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="768">
            <span class="hits">6</span>
            

            

            <code class="ruby">    @possible_moves.delete(&#39;up&#39;) if @head[:y] == @height - 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="769">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="770">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="771">
            
            

            

            <code class="ruby">  # If game mode is &#39;wrapped&#39;, and head is at edge of board, then add the direction off the edge of the board to @possible_moves</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="772">
            <span class="hits">6</span>
            

            

            <code class="ruby">  if @game_mode == &#39;wrapped&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="773">
            
            

            

            <code class="ruby">    @possible_moves.push(&#39;left&#39;) if (@head[:x]).zero?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="774">
            
            

            

            <code class="ruby">    @possible_moves.push(&#39;right&#39;) if @head[:x] == @width - 1</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="775">
            
            

            

            <code class="ruby">    @possible_moves.push(&#39;down&#39;) if (@head[:y]).zero?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="776">
            
            

            

            <code class="ruby">    @possible_moves.push(&#39;up&#39;) if @head[:y] == @height - 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="777">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="778">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="779">
            
            

            

            <code class="ruby">  # Once our snake&#39;s length is greater than that of any other snake.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="780">
            
            

            

            <code class="ruby">  # then we need to find the direction of the nearest snake&#39;s head and set @move_direction to that direction if it is in @possible_moves</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="781">
            
            

            

            <code class="ruby">  # DISABLED: This is now handled by the enhanced decision logic below</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="782">
            
            

            

            <code class="ruby">  # @snakes_info.each do |snake|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="783">
            
            

            

            <code class="ruby">  #   next unless snake[:length] &lt; @length - 3</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="784">
            
            

            

            <code class="ruby">  # </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="785">
            
            

            

            <code class="ruby">  #   puts &quot;Snake named #{snake[:name]} is shorter than me. It&#39;s length is #{snake[:length]} and mine is #{@length}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="786">
            
            

            

            <code class="ruby">  #   # Find the direction between our head and any shorter snake&#39;s head</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="787">
            
            

            

            <code class="ruby">  #   direction = direction_between(@head[:x], @head[:y], snake[:head][:x], snake[:head][:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="788">
            
            

            

            <code class="ruby">  #   # If the direction is in @possible_moves, then set @move_direction to that direction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="789">
            
            

            

            <code class="ruby">  #   if @possible_moves.include?(direction)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="790">
            
            

            

            <code class="ruby">  #     puts &quot;I&#39;m going to move #{direction} because I&#39;m going to eat a snake named #{snake[:name]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="791">
            
            

            

            <code class="ruby">  #     @move_direction = direction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="792">
            
            

            

            <code class="ruby">  #   end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="793">
            
            

            

            <code class="ruby">  # </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="794">
            
            

            

            <code class="ruby">  #   # If we are the longest by at least 2 cells, reduce our @health_threshold by 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="795">
            
            

            

            <code class="ruby">  #   if @length - snake[:length] &gt;= 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="796">
            
            

            

            <code class="ruby">  #     @health_threshold -= 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="797">
            
            

            

            <code class="ruby">  #     # Clamp the health threshold to a minimum of 55</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="798">
            
            

            

            <code class="ruby">  #     @health_threshold = 55 if @health_threshold &lt; 55</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="799">
            
            

            

            <code class="ruby">  #     puts &quot;I&#39;m going to eat a snake named #{snake[:name]}. I&#39;m going to reduce my health_threshold by 1 to #{@health_threshold}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="800">
            
            

            

            <code class="ruby">  #   end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="801">
            
            

            

            <code class="ruby">  # end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="802">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="803">
            
            

            

            <code class="ruby">  # Get highest score in @possible_turns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="804">
            <span class="hits">25</span>
            

            

            <code class="ruby">  @highest_score = @possible_turns.max_by { |turn| turn[:score] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="805">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="806">
            
            

            

            <code class="ruby">  # Create board state object for helper functions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="807">
            
            

            

            <code class="ruby">  board_state = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="808">
            <span class="hits">6</span>
            

            

            <code class="ruby">    head: @head,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="809">
            
            

            

            <code class="ruby">    food: @food,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="810">
            
            

            

            <code class="ruby">    hazards: @hazards,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="811">
            
            

            

            <code class="ruby">    snakes: @snakes,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="812">
            
            

            

            <code class="ruby">    snakes_heads_not_my_head: @snakes_heads_not_my_head,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="813">
            
            

            

            <code class="ruby">    all_occupied_cells: @all_occupied_cells,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="814">
            
            

            

            <code class="ruby">    head_neighbors: @head_neighbors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="815">
            
            

            

            <code class="ruby">    length: @length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="816">
            
            

            

            <code class="ruby">    width: @width,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="817">
            
            

            

            <code class="ruby">    height: @height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="818">
            
            

            

            <code class="ruby">    game_mode: @game_mode</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="819">
            
            

            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="820">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="821">
            
            

            

            <code class="ruby">  # Enhanced decision making with advanced algorithms</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="822">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="823">
            
            

            

            <code class="ruby">  # 0. First priority: Basic safety - avoid hazards when there are safe alternatives</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="824">
            <span class="hits">6</span>
            

            

            <code class="ruby">  unless @move_direction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="825">
            <span class="hits">6</span>
            

            

            <code class="ruby">    safe_from_hazards = @possible_moves.select do |move|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="826">
            <span class="hits">19</span>
            

            

            <code class="ruby">      next_pos = case move</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="827">
            <span class="hits">5</span>
            

            

            <code class="ruby">                when &#39;up&#39; then { x: @head[:x], y: @head[:y] + 1 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="828">
            <span class="hits">4</span>
            

            

            <code class="ruby">                when &#39;down&#39; then { x: @head[:x], y: @head[:y] - 1 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="829">
            <span class="hits">5</span>
            

            

            <code class="ruby">                when &#39;left&#39; then { x: @head[:x] - 1, y: @head[:y] }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="830">
            <span class="hits">5</span>
            

            

            <code class="ruby">                when &#39;right&#39; then { x: @head[:x] + 1, y: @head[:y] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="831">
            
            

            

            <code class="ruby">                end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="832">
            
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="833">
            
            

            

            <code class="ruby">      # Check if next position is a hazard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="402" data-linenumber="834">
            <span class="hits">402</span>
            

            

            <code class="ruby">      !@hazards.any? { |h| h[:x] == next_pos[:x] &amp;&amp; h[:y] == next_pos[:y] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="835">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="836">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="837">
            
            

            

            <code class="ruby">    # If we have hazard-free options and some moves would go into hazards, prefer safe moves</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="838">
            
            

            

            <code class="ruby">    # But only filter if we&#39;re not left with zero options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="839">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if safe_from_hazards.length &gt; 0 &amp;&amp; safe_from_hazards.length &lt; @possible_moves.length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="840">
            <span class="hits">3</span>
            

            

            <code class="ruby">      puts &quot;Filtering out hazardous moves, safe options: #{safe_from_hazards}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="841">
            <span class="hits">3</span>
            

            

            <code class="ruby">      @possible_moves = safe_from_hazards</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="842">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="843">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="844">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="845">
            
            

            

            <code class="ruby">  # 1. Second priority: Use A* pathfinding if we need food and health is low</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="846">
            <span class="hits">6</span>
            

            

            <code class="ruby">  if @health &lt; @health_threshold &amp;&amp; !@food.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="847">
            <span class="hits">6</span>
            

            

            <code class="ruby">    astar_move = a_star_to_food(board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="848">
            <span class="hits">6</span>
            

            

            <code class="ruby">    if astar_move &amp;&amp; @possible_moves.include?(astar_move)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="849">
            <span class="hits">1</span>
            

            

            <code class="ruby">      puts &quot;Using A* pathfinding to get food: #{astar_move}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="850">
            <span class="hits">1</span>
            

            

            <code class="ruby">      @move_direction = astar_move</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="851">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="852">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="853">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="854">
            
            

            

            <code class="ruby">  # 2. Third priority: Tail following when neighbors are risky or when it&#39;s a good strategy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="855">
            <span class="hits">6</span>
            

            

            <code class="ruby">  unless @move_direction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="856">
            
            

            

            <code class="ruby">    # Calculate where our tail is</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="857">
            <span class="hits">5</span>
            

            

            <code class="ruby">    my_tail_pos = @my_tail.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="858">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="859">
            
            

            

            <code class="ruby">    # Check if we should follow our tail when other moves are dangerous or limited</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="860">
            
            

            

            <code class="ruby">    # Look for moves that go towards our tail</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="861">
            <span class="hits">5</span>
            

            

            <code class="ruby">    if my_tail_pos</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="862">
            <span class="hits">5</span>
            

            

            <code class="ruby">      tail_direction = direction_between(@head[:x], @head[:y], my_tail_pos[:x], my_tail_pos[:y])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="863">
            
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="864">
            <span class="hits">5</span>
            

            

            <code class="ruby">      if tail_direction &amp;&amp; @possible_moves.include?(tail_direction)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="865">
            <span class="hits">5</span>
            

            

            <code class="ruby">        should_follow_tail = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="866">
            
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="867">
            
            

            

            <code class="ruby">        # Check for nearby enemy snakes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="868">
            <span class="hits">5</span>
            

            

            <code class="ruby">        nearby_enemies = @snakes_heads_not_my_head.select { |enemy_head| </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="869">
            <span class="hits">6</span>
            

            

            <code class="ruby">          manhattan_distance(@head, enemy_head) &lt;= 2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="870">
            
            

            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="871">
            
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="872">
            <span class="hits">5</span>
            

            

            <code class="ruby">        if @possible_moves.length &lt;= 2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="873">
            <span class="hits">3</span>
            

            

            <code class="ruby">          should_follow_tail = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="874">
            <span class="hits">3</span>
            

            

            <code class="ruby">          puts &quot;Following tail due to limited options: #{@possible_moves}, tail at #{my_tail_pos}, direction: #{tail_direction}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="875">
            <span class="hits">2</span>
            

            

            <code class="ruby">        elsif nearby_enemies.length &gt; 0 &amp;&amp; @possible_moves.length &lt;= 3</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="876">
            
            

            

            <code class="ruby">          should_follow_tail = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="877">
            
            

            

            <code class="ruby">          puts &quot;Following tail due to nearby enemies and limited options, enemies: #{nearby_enemies.length}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="878">
            <span class="hits">2</span>
            

            

            <code class="ruby">        elsif nearby_enemies.length &gt; 0 &amp;&amp; @possible_moves.length == 3</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="879">
            
            

            

            <code class="ruby">          # Even with 3 moves, if there&#39;s an enemy within distance 2, consider tail following</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="880">
            
            

            

            <code class="ruby">          should_follow_tail = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="881">
            
            

            

            <code class="ruby">          puts &quot;Following tail due to nearby enemies, enemies: #{nearby_enemies.length}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="882">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="883">
            
            

            

            <code class="ruby">        </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="884">
            <span class="hits">5</span>
            

            

            <code class="ruby">        if should_follow_tail</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="885">
            <span class="hits">3</span>
            

            

            <code class="ruby">          @move_direction = tail_direction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="886">
            <span class="hits">3</span>
            

            

            <code class="ruby">          puts &quot;Following tail for safety: #{@move_direction}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="887">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="888">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="889">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="890">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="891">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="892">
            
            

            

            <code class="ruby">  # 3. Fourth priority: Space control - avoid getting trapped, but ensure minimum safety</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="893">
            <span class="hits">6</span>
            

            

            <code class="ruby">  unless @move_direction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="894">
            <span class="hits">2</span>
            

            

            <code class="ruby">    space_control = get_space_control_move(board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="895">
            <span class="hits">2</span>
            

            

            <code class="ruby">    min_space_required = [(@width * @height * 0.3).to_i, @length * 2].max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="896">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="897">
            
            

            

            <code class="ruby">    # Only use space control if the move is safe and has adequate space</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="898">
            <span class="hits">2</span>
            

            

            <code class="ruby">    if space_control[:space_size] &gt;= min_space_required &amp;&amp; space_control[:move] &amp;&amp; @possible_moves.include?(space_control[:move])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="899">
            
            

            

            <code class="ruby">      # Additional safety check: make sure this move doesn&#39;t go into immediate danger</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="900">
            <span class="hits">2</span>
            

            

            <code class="ruby">      next_pos = case space_control[:move]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="901">
            
            

            

            <code class="ruby">                when &#39;up&#39; then { x: @head[:x], y: @head[:y] + 1 }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="902">
            
            

            

            <code class="ruby">                when &#39;down&#39; then { x: @head[:x], y: @head[:y] - 1 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="903">
            <span class="hits">2</span>
            

            

            <code class="ruby">                when &#39;left&#39; then { x: @head[:x] - 1, y: @head[:y] }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="904">
            
            

            

            <code class="ruby">                when &#39;right&#39; then { x: @head[:x] + 1, y: @head[:y] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="905">
            
            

            

            <code class="ruby">                end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="906">
            
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="907">
            
            

            

            <code class="ruby">      # Check if it&#39;s safe from hazards and not obviously dangerous</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="908">
            <span class="hits">54</span>
            

            

            <code class="ruby">      is_safe = !@hazards.any? { |h| h[:x] == next_pos[:x] &amp;&amp; h[:y] == next_pos[:y] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="909">
            
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="910">
            <span class="hits">2</span>
            

            

            <code class="ruby">      if is_safe</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="911">
            <span class="hits">2</span>
            

            

            <code class="ruby">        puts &quot;Using space control move: #{space_control[:move]} (space: #{space_control[:space_size]})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="912">
            <span class="hits">2</span>
            

            

            <code class="ruby">        @move_direction = space_control[:move]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="913">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="914">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="915">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="916">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="917">
            
            

            

            <code class="ruby">  # 4. Fifth priority: Attack weaker snakes if we&#39;re significantly longer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="918">
            <span class="hits">6</span>
            

            

            <code class="ruby">  unless @move_direction</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="919">
            
            

            

            <code class="ruby">    @snakes_info.each do |snake|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="920">
            
            

            

            <code class="ruby">      if snake[:length] &lt; @length - 3</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="921">
            
            

            

            <code class="ruby">        attack_direction = direction_between(@head[:x], @head[:y], snake[:head][:x], snake[:head][:y])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="922">
            
            

            

            <code class="ruby">        if @possible_moves.include?(attack_direction)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="923">
            
            

            

            <code class="ruby">          # But only attack if we won&#39;t get trapped</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="924">
            
            

            

            <code class="ruby">          next_pos = case attack_direction</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="925">
            
            

            

            <code class="ruby">                    when &#39;up&#39; then { x: @head[:x], y: @head[:y] + 1 }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="926">
            
            

            

            <code class="ruby">                    when &#39;down&#39; then { x: @head[:x], y: @head[:y] - 1 }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="927">
            
            

            

            <code class="ruby">                    when &#39;left&#39; then { x: @head[:x] - 1, y: @head[:y] }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="928">
            
            

            

            <code class="ruby">                    when &#39;right&#39; then { x: @head[:x] + 1, y: @head[:y] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="929">
            
            

            

            <code class="ruby">                    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="930">
            
            

            

            <code class="ruby">          </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="931">
            
            

            

            <code class="ruby">          space_after_attack = flood_fill_from(next_pos, board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="932">
            
            

            

            <code class="ruby">          if space_after_attack &gt;= @length + 5</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="933">
            
            

            

            <code class="ruby">            puts &quot;Attacking weaker snake #{snake[:name]}: #{attack_direction}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="934">
            
            

            

            <code class="ruby">            @move_direction = attack_direction</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="935">
            
            

            

            <code class="ruby">            break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="936">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="937">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="938">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="939">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="940">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="941">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="942">
            
            

            

            <code class="ruby">  # 5. Sixth priority: Avoid predicted enemy moves</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="943">
            <span class="hits">6</span>
            

            

            <code class="ruby">  unless @move_direction</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="944">
            
            

            

            <code class="ruby">    enemy_predictions = predict_enemy_moves(board_state)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="945">
            
            

            

            <code class="ruby">    safe_moves = @possible_moves.select do |move|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="946">
            
            

            

            <code class="ruby">      next_pos = case move</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="947">
            
            

            

            <code class="ruby">                when &#39;up&#39; then { x: @head[:x], y: @head[:y] + 1 }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="948">
            
            

            

            <code class="ruby">                when &#39;down&#39; then { x: @head[:x], y: @head[:y] - 1 }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="949">
            
            

            

            <code class="ruby">                when &#39;left&#39; then { x: @head[:x] - 1, y: @head[:y] }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="950">
            
            

            

            <code class="ruby">                when &#39;right&#39; then { x: @head[:x] + 1, y: @head[:y] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="951">
            
            

            

            <code class="ruby">                end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="952">
            
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="953">
            
            

            

            <code class="ruby">      # Check if any predicted enemy move would collide with our next position</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="954">
            
            

            

            <code class="ruby">      safe = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="955">
            
            

            

            <code class="ruby">      enemy_predictions.each do |enemy_id, predicted_pos|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="956">
            
            

            

            <code class="ruby">        if predicted_pos &amp;&amp; predicted_pos[:x] == next_pos[:x] &amp;&amp; predicted_pos[:y] == next_pos[:y]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="957">
            
            

            

            <code class="ruby">          enemy_snake = @snakes.find { |s| s[:id] == enemy_id }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="958">
            
            

            

            <code class="ruby">          if enemy_snake &amp;&amp; enemy_snake[:length] &gt;= @length</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="959">
            
            

            

            <code class="ruby">            safe = false</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="960">
            
            

            

            <code class="ruby">            break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="961">
            
            

            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="962">
            
            

            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="963">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="964">
            
            

            

            <code class="ruby">      safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="965">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="966">
            
            

            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="967">
            
            

            

            <code class="ruby">    if !safe_moves.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="968">
            
            

            

            <code class="ruby">      # Choose the safest move with highest score</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="969">
            
            

            

            <code class="ruby">      best_safe_move = safe_moves.max_by do |move|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="970">
            
            

            

            <code class="ruby">        turn = @possible_turns.find { |t| t[:direction] == move }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="971">
            
            

            

            <code class="ruby">        turn ? turn[:score] : 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="972">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="973">
            
            

            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="974">
            
            

            

            <code class="ruby">      if best_safe_move</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="975">
            
            

            

            <code class="ruby">        puts &quot;Using safe move avoiding enemy predictions: #{best_safe_move}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="976">
            
            

            

            <code class="ruby">        @move_direction = best_safe_move</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="977">
            
            

            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="978">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="979">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="980">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="981">
            
            

            

            <code class="ruby">  # 6. Final fallback: Use the highest scoring move that&#39;s actually possible</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="982">
            <span class="hits">6</span>
            

            

            <code class="ruby">  unless @move_direction</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="983">
            
            

            

            <code class="ruby">    if @highest_score.nil? || !@possible_moves.include?(@highest_score[:direction])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="984">
            
            

            

            <code class="ruby">      # Choose any possible move (prefer ones that aren&#39;t walls)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="985">
            
            

            

            <code class="ruby">      @move_direction = @possible_moves.first || &#39;up&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="986">
            
            

            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="987">
            
            

            

            <code class="ruby">      @move_direction = @highest_score[:direction]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="988">
            
            

            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="989">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="990">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="991">
            
            

            

            <code class="ruby">  #puts &quot;Move direction is: #{@move_direction} - highest score is: #{@highest_score[:score]} - turn is: #{@highest_score[:types]} to the #{@highest_score[:direction]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="992">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="993">
            
            

            

            <code class="ruby">  #TODO Function to use A* to find the safest path to food</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="994">
            
            

            

            <code class="ruby">  # A safe path is one that stays away from longer snakes, bodies, and hazards</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="995">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="996">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="997">
            
            

            

            <code class="ruby">  # Output the end time in ms</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="998">
            <span class="hits">6</span>
            

            

            <code class="ruby">  end_time = Time.now</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="999">
            <span class="hits">6</span>
            

            

            <code class="ruby">  puts &quot;End time is: #{end_time} - took #{end_time - start_time} seconds&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1000">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="1001">
            <span class="hits">6</span>
            

            

            <code class="ruby">  debug = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1002">
            
            

            

            <code class="ruby"># Debug output, only if debug is true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="1003">
            <span class="hits">6</span>
            

            

            <code class="ruby">  if debug</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1004">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1005">
            
            

            

            <code class="ruby">  puts &quot;Possible moves are: </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1006">
            
            

            

            <code class="ruby">  #{@possible_moves}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1007">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1008">
            
            

            

            <code class="ruby">  puts &quot;possible_turns are: </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1009">
            
            

            

            <code class="ruby">  #{@possible_turns}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1010">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1011">
            
            

            

            <code class="ruby">  puts &quot;Highest score is #{@highest_score}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1012">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1013">
            
            

            

            <code class="ruby">  # Most common cell types from @turn_score_array and their counts and scores</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1014">
            
            

            

            <code class="ruby">  @turn_score_array.group_by { |cell| cell[:types] }.map { |types, cells| [types, cells.count] }.sort_by { |types, count| count }.reverse.each do |types, count|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1015">
            
            

            

            <code class="ruby">    puts &quot;Most common #{types} - #{count}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1016">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1017">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1018">
            
            

            

            <code class="ruby">  # Least common 5 cell types from @turn_score_array and their counts</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1019">
            
            

            

            <code class="ruby">  @turn_score_array.group_by { |cell| cell[:types] }.map { |types, cells| [types, cells.count] }.sort_by { |types, count| count }.first(5).each do |types, count|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1020">
            
            

            

            <code class="ruby">    puts &quot;Least common #{types} - #{count}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1021">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1022">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1023">
            
            

            

            <code class="ruby">  # Top 5 highest scores from @turn_score_array and their counts</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1024">
            
            

            

            <code class="ruby">  @turn_score_array.group_by { |cell| cell[:score] }.map { |score, cells| [score, cells.count] }.sort_by { |score, count| score }.reverse.first(5).each do |score, count|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1025">
            
            

            

            <code class="ruby">    puts &quot;highest scores #{score} - #{count}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1026">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1027">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1028">
            
            

            

            <code class="ruby">  # Lowest 5 scores from @turn_score_array and their counts</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1029">
            
            

            

            <code class="ruby">  @turn_score_array.group_by { |cell| cell[:score] }.map { |score, cells| [score, cells.count] }.sort_by { |score, count| score }.first(5).each do |score, count|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1030">
            
            

            

            <code class="ruby">    puts &quot;lowest scores #{score} - #{count}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1031">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1032">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1033">
            
            

            

            <code class="ruby">  # Most common cell types and score combinations from @turn_score_array</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1034">
            
            

            

            <code class="ruby">  @turn_score_array.group_by { |cell| cell[:types] }.map { |types, cells| [types, cells.map { |cell| cell[:score] }.reduce(:+)] }.sort_by { |types, score| score }.reverse.each do |types, score|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1035">
            
            

            

            <code class="ruby">    puts &quot;Most common #{types} - #{score}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1036">
            
            

            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1037">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1038">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1039">
            
            

            

            <code class="ruby">  # TODO:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1040">
            
            

            

            <code class="ruby">  # Generate a ascii representation of the board</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1041">
            
            

            

            <code class="ruby">  # Cells are placed in their x,y coordianres on a grid the of size @width x @height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1042">
            
            

            

            <code class="ruby">  # Each cell is represented by a single character</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1043">
            
            

            

            <code class="ruby">  # Board edges are represented by &#39;#&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1044">
            
            

            

            <code class="ruby">  # Food is represented by &#39;F&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1045">
            
            

            

            <code class="ruby">  # Snake head is represented by &#39;H&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1046">
            
            

            

            <code class="ruby">  # Snake body is represented by &#39;B&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1047">
            
            

            

            <code class="ruby">  # Snake tail is represented by &#39;T&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1048">
            
            

            

            <code class="ruby">  # Empty cells are represented by &#39;0&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1049">
            
            

            

            <code class="ruby">  # Snake head neighbors are represented by &#39;h&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1050">
            
            

            

            <code class="ruby">  # Snake body neighbors are represented by &#39;b&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1051">
            
            

            

            <code class="ruby">  # Hazard cells are represented by &#39;X&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1052">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1053">
            
            

            

            <code class="ruby">  </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1054">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1055">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="1056">
            <span class="hits">6</span>
            

            

            <code class="ruby">  puts &quot;MOVE: #{@move_direction} - TURN: #{board[:turn]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="1057">
            <span class="hits">6</span>
            

            

            <code class="ruby">  { move: @move_direction }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1058">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a0fd061293fd095d34df636e6fce494a596225be">
  <div class="header">
    <h3>snakes/ruby/djdefi/app/util.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    

    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            
            

            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            <span class="hits">1</span>
            

            

            <code class="ruby">require &#39;active_support/all&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            
            

            

            <code class="ruby"># Turns a hash from { hi_there: true } to { &quot;hiThere&quot;: true } to match engine</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            
            

            

            <code class="ruby"># syntax.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            <span class="hits">1</span>
            

            

            <code class="ruby">def camelcase(hash)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="8">
            <span class="hits">18</span>
            

            

            <code class="ruby">  hash.deep_transform_keys { |key| key.to_s.camelize(:lower) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            
            

            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            
            

            

            <code class="ruby"># Turns a hash from { &quot;hiThere&quot;: true } to { hi_there: true } to match ruby</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            
            

            

            <code class="ruby"># like syntax.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            <span class="hits">1</span>
            

            

            <code class="ruby">def underscore(hash)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="918" data-linenumber="14">
            <span class="hits">918</span>
            

            

            <code class="ruby">  hash.deep_transform_keys { |key| key.to_s.underscore.to_sym }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            
            

            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
